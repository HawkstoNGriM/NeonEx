<?php 

function findInCsv($query, $version,$datasetfile) {
    $row = 1;
    $relatedSure = [];
    $relatedMaybe = [];
    if (($handle = fopen($datasetfile, "r")) !== FALSE) {
    while (($data = fgetcsv($handle, 0, ",")) !== FALSE) {
        $num = count($data);
        //echo "<p> $num fields in line $row: <br /></p>\n";
        $row++;
        for ($c=0; $c < $num; $c++) {
            if(str_contains(strtoupper($data[$c]), strtoupper($query))){
                //echo $data[2] . " - - " . $data[1] . "<br/>";
                $version2 = " " . $version;
                if(str_contains(strtoupper($data[2]),strtoupper($version2))){
                    if(str_contains(strtoupper($data[2]), strtoupper("plugin"))){
                        $inp1 = "[?] " . $data[2] . " - - " . $data[1];
                        array_push($relatedMaybe,$inp1);
                    }else {
                        $inp1 = "[+] " . $data[2] . " - - " . $data[1];
                        array_push($relatedSure,$inp1);
                    }
                    
                    //echo htmlentities($inp1);
                    //echo "<br/>";
                }elseif (str_contains(strtoupper($data[2]), strtoupper($version))){
                    if(str_contains(strtoupper($data[2]), strtoupper("plugin"))){
                        $inp1 = "[?] " . $data[2] . " - - " . $data[1];
                        array_push($relatedMaybe,$inp1);
                    }else {
                        $inp1 = "[+] " . $data[2] . " - - " . $data[1];
                        array_push($relatedSure,$inp1);
                    }
                    //echo htmlentities($inp1);
                    //echo "<br/>";
                } else {}

            }
        }
    }
    fclose($handle);
    }

    return array($relatedSure,$relatedMaybe);

    /*
    foreach($relatedSure as $rs) {
        echo htmlentities($rs);
        echo "<br/>";
    }
    foreach($relatedMaybe as $rm) {
        echo htmlentities($rm);
        echo "<br/>";
    }
    */




}



//findInCsv("WordPress","3.0","Resources/files_exploits.csv");

?>
