
<?php 

//          IMPLEMENTED  \\ 
if(isset($_GET["query"])){
    if($_GET["query"] !== ""){
        echo "Finder initiated... </br>";
        $rez = $_GET["query"];
        
        #echo $rez . " - before cleaning </br>";

        $possiblePluginNames = ["plugin", "plug-in", "extension", "/theme","add-on","add-in","addon"];
        foreach($possiblePluginNames as $ppn){
            $rez = str_replace($ppn,"",$rez);
        }

        #remove all the tags
        $rez = strip_tags($rez);

        #lowercase it so its easier
        $rez = strtolower($rez);

        #remove all the https
        $rez = str_replace("https","",$rez);
        $rez = str_replace("http","",$rez);
        
        #remove all the localhost
        $rez = str_replace($_SERVER['HTTP_HOST'], "", $rez); 

        #remove all the dirs and stuff
        $rez = str_replace(">","",$rez);
        $rez = str_replace("<","",$rez);
        $rez = str_replace(":","",$rez);
        $rez = str_replace(".","",$rez);
        $rez = stripslashes($rez);

        #now remove all the one letter things
        $rez = explode(" ",$rez);
        #print_r($rez);
        #echo "<hr/>";
        for($x = 0 ; $x < count($rez) ; $x++){
            if(strlen($rez[$x]) < 2){
                unset($rez[$x]);
            }
        }
        $rez = join(" ", $rez);
        
        echo $rez . "</br>";


        # T O D O 
        #implement for the user to edit himself
        #add this to input value and he will just delete and search
        #after he searches it goes to exploitfinder

        #TO ALLLOW
        #exploitFinder($rez);
    }
}
function exploitFinder($query){

      header('Content-Type: text/html; charset=utf-8');

    $query = urlencode($query);

    $url = "https://www.exploitalert.com/api/search-exploit?name=$query";

    #echo "Requesting : " . $url . "<br><br/>";
    try{
        $request = file_get_contents($url);
    }
    catch (Exception $w){
        echo "Error in exploitFinder :" . $w;
    }
    #echo $request;
    $data = json_decode($request);
    #echo "<br><br>";
    
    foreach($data as $key => $value){
        try{
        echo '<p style="font-size:10px;">';
        echo $value->name . " (" . $value->date . ") " . "<a href='https://www.exploit-db.com/exploits/" . $value->id . "'> Exploit Source ðŸ›‘ </a>";
        echo "<hr>";
        # so now we form Exploitdb url based on ID given
        # https://www.exploit-db.com/exploits/ID (without #)
        echo '</p>';
        }
        catch (Exception $e){
            echo "Error in exploitFinder: " . $e;
        }
        
    }
    


    // https://www.exploitalert.com/api/search-exploit?name=wordpress%203
    // is GET for "wordpress 3"  (%20 being space)


}


//exploitFinder("Wordpress 3");

?>