
<?php 

//Maybe its cause we call function twice?

//          IMPLEMENTED - for plugins  \\ 
if(isset($_GET["query"])){
    if($_GET["query"] !== ""){
        #echo "Finder initiated... </br>";
        $rez = $_GET["query"];
        
        #echo $rez . " - before cleaning </br>";
        exploitFinder($rez);
    }
}
function exploitFinder($query){

    #header('Content-Type: text/html; charset=utf-8');
    $rezultz = [];

    $query = urlencode($query);

    #have to remove double + if there are two spaces or whatever
    #cause otherwise it returns nothing
    if(str_contains($query, "++")){
        $query = str_replace("++","+",$query);
    }
    
    $url = "https://www.exploitalert.com/api/search-exploit?name=$query";
    $data = "";
    #echo "Requesting : " . $url . "<br><br/>";
    try{
        $request = file_get_contents($url);
        $data = json_decode($request);
    }
    catch (Exception $w){
        echo "Error in exploitFinder :" . $w;
    }
    #echo $request;
    
    #echo "<br><br>";
    if($data !== "" && $data !== NULL){
        foreach($data as $key => $value){
            try{
            #echo '<p style="font-size:10px;">';
            $thing = $value->name . " (" . $value->date . ") " . "<a href='https://www.exploit-db.com/exploits/" . $value->id . "'> Exploit Source ðŸ›‘ </a>";
            array_push($rezultz,$thing);
            #echo "<hr>";
            # so now we form Exploitdb url based on ID given
            # https://www.exploit-db.com/exploits/ID (without #)
            #echo '</p>';
            }
            catch (Exception $e){
                echo "Error in exploitFinder: " . $e;
            }
            
        }
    } else{
        echo "<br/> ExploitFinder Didn't find any exploits (Or you lost internet connection).";
    }

    if(count($rezultz) > 0){
        return $rezultz;
    }else{
        return "";
    }
    

    // https://www.exploitalert.com/api/search-exploit?name=wordpress%203
    // is GET for "wordpress 3"  (%20 being space)


}


//exploitFinder("Wordpress 3");

?>